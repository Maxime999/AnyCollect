<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AnyCollect: AnyCollect Usage</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AnyCollect
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('USAGE_8md.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0"
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="namespaceAnyCollect.html">AnyCollect</a> Usage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Contents</h2>
<ul>
<li><a href="#anycollect-usage">AnyCollect Usage</a><ul>
<li><a href="#contents">Contents</a></li>
<li><a href="#metrics">Metrics</a><ul>
<li><a href="#sources">Sources</a></li>
<li><a href="#expressions">Expressions</a></li>
<li><a href="#metrics-and-substitution">Metrics and substitution</a></li>
<li><a href="#examples">Examples</a><ul>
<li><a href="#basic-file-matching">Basic file matching</a></li>
<li><a href="#multiple-metrics-on-one-line">Multiple metrics on one line:</a></li>
<li><a href="#command-output-matching">Command output matching</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#anycollectvalues-standalone-interface">AnyCollectValues Standalone interface</a></li>
<li><a href="#snap-configuration">Snap Configuration</a><ul>
<li><a href="#global-configuration">Global configuration</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#parameters">Parameters</a></li>
<li><a href="#metrics-1">Metrics</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><b>Please be careful about metric instantiation rules.</b> They are detailed below in <a href="#metrics-and-substitution">Metrics and substitution</a>.</p>
<h2>Metrics</h2>
<p><a class="el" href="namespaceAnyCollect.html">AnyCollect</a> can gather metrics from two different kinds of sources:</p><ul>
<li>Reading files from the filesystem</li>
<li>Executing commands</li>
</ul>
<p>Each of these sources have an array of expressions which are used to filter and match the contents. Each expression is a regex and an array of metrics templates, which use regex matches to form metrics.</p>
<h3>Sources</h3>
<p>Metrics are defined in a JSON file: </p><div class="fragment"><div class="line">{</div><div class="line">  &quot;Files&quot;: [</div><div class="line">    {</div><div class="line">      &quot;Paths&quot;: [</div><div class="line">        &quot;&quot;</div><div class="line">      ],</div><div class="line">      &quot;Expressions&quot;: [...]</div><div class="line">    }</div><div class="line">  ]</div><div class="line">  &quot;Commands&quot;: [</div><div class="line">    {</div><div class="line">      &quot;Program&quot;: &quot;&quot;,</div><div class="line">      &quot;Arguments&quot;: [</div><div class="line">        &quot;&quot;</div><div class="line">      ],</div><div class="line">      &quot;Expressions&quot;: [...]</div><div class="line">    }</div><div class="line">  ],</div><div class="line">}</div></div><!-- fragment --><p>Metrics from reading file contents are specified in the top-level <code>Files</code> array. Each require two fields:</p><ul>
<li><code>Paths</code>, an array of strings representing the paths of files to read</li>
<li><code>Expressions</code>, an array of expressions (see <a href="#expressions">below</a>) used to match file contents</li>
</ul>
<p>Paths support standard POSIX globbing (with wildcards, etc.). You can specify multiple paths to be matched against the same expressions.</p>
<p>Metrics from command output are specified in the top-level <code>Command</code> array. It requires three fields:</p><ul>
<li><code>Program</code>, the main program to execute</li>
<li><code>Arguments</code>, an array of additional arguments to give to the program</li>
<li><code>Expressions</code>, an array of expressions (see <a href="#expressions">below</a>) used to match command output</li>
</ul>
<p>Prior to execution, program and arguments are concatenated with spaces in between.</p>
<h3>Expressions</h3>
<p>An expression is defined by two fields:</p><ul>
<li><code>Regex</code>, a regular expression string (backslashes <code>\</code> and quotes <code>"</code> should be escaped)</li>
<li><code>Metrics</code>, an array of metric templates</li>
</ul>
<p>A metric template is in turn defined in JSON by six fields:</p><ul>
<li><code>Name</code>, an array of strings representing the name of the metric</li>
<li><code>Value</code>, a string representing the value of the metric</li>
<li><code>Unit</code>, a string representing the value's unit</li>
<li><code>Tags</code>, a map associating strings to strings adding metadata to a metric</li>
<li><code>ComputeRate</code>, a boolean indicating whether the variation of the value, rather than the value, should be collected</li>
<li><code>ConvertToUnitsPerSecond</code>, a boolean indicating whether the value should be converted to units per second</li>
</ul>
<p>The regex will be applied for each line of content. If a match is found, metric templates are attempted to be filled with variable substitution.</p>
<p>One expression may have more than one metric template to facilitate parsing: if a line contains multiple metrics, the whole line can be matched by the regex and each metric template will extract one metric from the regex match.</p>
<h3>Metrics and substitution</h3>
<p>String fields of a metric template (<code>Name</code>, <code>Value</code>, <code>Unit</code> and <code>Tags</code>) are subject to variable substitution:</p><ul>
<li><code>$1</code>, <code>$2</code>, <code>$3</code>, etc. will be replaced by the regex submatch with the same index. <code>$0</code> matches the whole match</li>
<li>for file content sources, <code>$path_0</code>, <code>$path_1</code>, <code>$path_2</code>, etc. will be replaced by the path component at the same index</li>
</ul>
<p><b>Important notes after substitution</b>:</p><ul>
<li><b>A metric is defined by its <code>Name</code> and <code>Tags</code> fields</b>: if two metrics have the same <code>Name</code> and <code>Tags</code>, they are considered to represent the same thing. The <code>Unit</code> field is not taken into account. This equivalence is used to compute rates from an iteration to the next, and in case two metrics are found to be equivalent during the same iteration then their values are added.</li>
<li><b>The <code>Value</code> field may be a simple mathematic expressions</b>. Integer or floating point numbers are supported, as well as operands <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>%</code> (modulo), <code>^</code> (power), <code>(</code> and <code>)</code>; some function are also supported (<code>sqrt</code>, <code>exp</code>, <code>log</code>, <code>cos</code>, <code>sin</code>, <code>tan</code>, ...). If the expression is not valid, or can't be converted to a number, the metric is dropped.</li>
<li><b>If any of <code>Name</code>, <code>Value</code>, or <code>Tags</code> field is empty, the metric is considered deficient and is dropped.</b> The <code>Unit</code> field may be empty.</li>
<li><b>The <code>Name</code> field should only contain lower-case alphanumeric characters and underscores <code>_</code>.</b> Upper-case letters will be converted to lower-case, and symbols will be replaced by underscores.</li>
</ul>
<h3>Examples</h3>
<p><b>Please refer to the examples config files in the <code>example</code> directory of this repo.</b></p>
<h4>Basic file matching</h4>
<p>Memory stats in <code>/proc/meminfo</code> </p><div class="fragment"><div class="line">MemTotal: 949448 kB</div></div><!-- fragment --><p>Regex: <code>^(\w+) (\d+) (\w)B$</code></p>
<p>Matches: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Index  </th><th class="markdownTableHeadNone">Submatch   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0  </td><td class="markdownTableBodyNone"><code>MemTotal: 949448 kB</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone"><code>MemTotal</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone"><code>949448</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone"><code>k</code>   </td></tr>
</table>
<p>Metrics: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Template  </th><th class="markdownTableHeadNone">Metric   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><ul style="list-style: none;">
<li>
Name: <code>["memory", "$1"]</code>, </li>
<li>
Value: <code>"$2"</code>, </li>
<li>
Unit: <code>"$3B"</code>, </li>
<li>
Tags: <code>{}</code> </li>
</ul>
</td><td class="markdownTableBodyNone"><ul style="list-style: none;">
<li>
Name: <code>["memory", "MemTotal"]</code>, </li>
<li>
Value: <code>949448</code>, </li>
<li>
Unit: <code>"kB"</code>, </li>
<li>
Tags: <code>{}</code> </li>
</ul>
</td></tr>
</table>
<h4>Multiple metrics on one line:</h4>
<p>CPU stats in <code>/proc/stat</code> </p><div class="fragment"><div class="line">cpu  14574109 23322 24156706 688820875 542455 0 1102485 0 0</div></div><!-- fragment --><p>Regex: <code>^cpu (\d+) \d+ (\d+) (\d+)</code></p>
<p>Matches: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Index  </th><th class="markdownTableHeadNone">Submatch   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0  </td><td class="markdownTableBodyNone"><code>cpu 14574109 23322 24156706 688820875</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone"><code>cpu</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone"><code>14574109</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone"><code>24156706</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone"><code>688820875</code>   </td></tr>
</table>
<p>Metrics: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Template  </th><th class="markdownTableHeadNone">Metric   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><ul style="list-style: none;">
<li>
Name: <code>["cpu", "user"]</code>, </li>
<li>
Value: <code>"$1"</code>, </li>
<li>
Unit: <code>"jiffies"</code>, </li>
<li>
Tags: <code>{}</code> </li>
</ul>
</td><td class="markdownTableBodyNone"><ul style="list-style: none;">
<li>
Name: <code>["cpu", "user"]</code>, </li>
<li>
Value: <code>14574109</code>, </li>
<li>
Unit: <code>"jiffies"</code>, </li>
<li>
Tags: <code>{}</code> </li>
</ul>
</td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"><ul style="list-style: none;">
<li>
Name: <code>["cpu", "system"]</code>, </li>
<li>
Value: <code>"$2"</code>, </li>
<li>
Unit: <code>"jiffies"</code>, </li>
<li>
Tags: <code>{}</code> </li>
</ul>
</td><td class="markdownTableBodyNone"><ul style="list-style: none;">
<li>
Name: <code>["cpu", "system"]</code>, </li>
<li>
Value: <code>24156706</code>, </li>
<li>
Unit: <code>"jiffies"</code>, </li>
<li>
Tags: <code>{}</code> </li>
</ul>
</td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><ul style="list-style: none;">
<li>
Name: <code>["cpu", "idle"]</code>, </li>
<li>
Value: <code>"$3"</code>, </li>
<li>
Unit: <code>"jiffies"</code>, </li>
<li>
Tags: <code>{}</code> </li>
</ul>
</td><td class="markdownTableBodyNone"><ul style="list-style: none;">
<li>
Name: <code>["cpu", "idle"]</code>, </li>
<li>
Value: <code>688820875</code>, </li>
<li>
Unit: <code>"jiffies"</code>, </li>
<li>
Tags: <code>{}</code> </li>
</ul>
</td></tr>
</table>
<h4>Command output matching</h4>
<p>Get network latency with <code>ping</code> </p><div class="fragment"><div class="line">$ ping -c 1 -W 1 8.8.8.8</div><div class="line">PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.</div><div class="line">64 bytes from 8.8.8.8: icmp_seq=1 ttl=61 time=2.74 ms</div><div class="line">...</div></div><!-- fragment --><p>Regex: <code>bytes from ([\d.]+): .* time=([\d.]+) (\w+)$</code></p>
<p>Matches: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Index  </th><th class="markdownTableHeadNone">Submatch   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0  </td><td class="markdownTableBodyNone"><code>bytes from 8.8.8.8: icmp_seq=1 ttl=61 time=2.74 ms</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone"><code>8.8.8.8</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone"><code>2.74</code>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone"><code>ms</code>   </td></tr>
</table>
<p>Metrics: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Template  </th><th class="markdownTableHeadNone">Metric   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><ul style="list-style: none;">
<li>
Name: <code>["ping"]</code>, </li>
<li>
Value: <code>"$2"</code>, </li>
<li>
Unit: <code>"$3"</code>, </li>
<li>
Tags: <code>{ "host": "$1" }</code> </li>
</ul>
</td><td class="markdownTableBodyNone"><ul style="list-style: none;">
<li>
Name: <code>["ping"]</code>, </li>
<li>
Value: <code>2.74</code>, </li>
<li>
Unit: <code>"ms"</code>, </li>
<li>
Tags: <code>{ "host": "8.8.8.8" }</code> </li>
</ul>
</td></tr>
</table>
<h2><a class="el" href="structAnyCollectValues.html">AnyCollectValues</a> Standalone interface</h2>
<p>This program collects all available metrics and prints them on the standard output. For each metric, it shows its name, its value and its unit.</p>
<p><a class="el" href="structAnyCollectValues.html">AnyCollectValues</a> can take up to <b>three arguments</b>:</p><ul>
<li>the sampling interval in second, that is the duration to wait between two readings of kernel values. Default is 1 second</li>
<li>JSON configuration file path</li>
<li>how many times to report metrics. Default is 0, which means unlimited time</li>
</ul>
<p>For example, <code>./AnyCollectValues 60 ./config.json 10</code> will read the config file <code>./config.json</code>, and then collect metrics and print them every 60 seconds; it will do so 10 times. The program will thus run for 10 minutes.</p>
<h2>Snap Configuration</h2>
<h3>Global configuration</h3>
<p>In order for the <a class="el" href="namespaceAnyCollect.html">AnyCollect</a> plugin to be aware of its configuration before Snap launches a task (otherwise metrics won't be registered), the configuration file must be specified in <code>snapteld</code> global config:</p>
<div class="fragment"><div class="line">---</div><div class="line">control:</div><div class="line">  plugins:</div><div class="line">    collector:</div><div class="line">      anycollect:</div><div class="line">        all:</div><div class="line">          ConfigFile: /etc/snap/anycollect.json</div></div><!-- fragment --><p>However, if you choose to send all metrics described by a configuration file, this global configuration is not needed. You can tell the plugin to send all metrics in the task file, either by setting <code>SendAllMetrics</code> to true or by requesting the metric <code>/cfm/anycollect/*</code>.</p>
<h3>Configuration</h3>
<p>First set up the <a href="https://github.com/intelsdi-x/snap/blob/master/README.md#getting-started">Snap framework</a>.</p>
<p>The default configuration for a <a class="el" href="namespaceAnyCollect.html">AnyCollect</a> Snap task is the following: </p><div class="fragment"><div class="line">---</div><div class="line">  version: 1</div><div class="line">  schedule:</div><div class="line">    type: &quot;streaming&quot;</div><div class="line">  max-failures: 10</div><div class="line">  workflow:</div><div class="line">    collect:</div><div class="line">      metrics:</div><div class="line">        /cfm/anycollect/*: {}</div><div class="line">      config:</div><div class="line">        /cfm:</div><div class="line">          ConfigFile: &quot;/path/to/anycollect/config.json&quot;</div><div class="line">          SamplingInterval: 1</div><div class="line">          SendAllMetrics: false</div><div class="line">          # MaxMetricsBuffer: 0</div><div class="line">          # MaxCollectDuration: 0</div><div class="line">      publish:</div><div class="line">        ...</div></div><!-- fragment --><h3>Parameters</h3>
<p>The parameters are (default values are given <a href="#configuration">above</a>):</p><ul>
<li><code>ConfigFile</code> (type string): path to <a class="el" href="namespaceAnyCollect.html">AnyCollect</a>'s JSON configuration file</li>
<li><code>SamplingInterval</code> (type int): delay in seconds between two readings of the kernel values</li>
<li><code>SendAllMetrics</code> (type boolean): whether to send all metrics to Snap, ignoring requested metrics in the task. This is a workaround: if the config file is modified and the Snap daemon not restarted, Snap doesn't update the metric list and new metrics won't be sent</li>
<li><code>MaxMetricsBuffer</code> (type int): maximum number of metrics to send to Snap at once</li>
<li><code>MaxCollectDuration</code> (type int): maximum waiting time (in seconds) before sending metrics to Snap</li>
</ul>
<h3>Metrics</h3>
<p>Collected metrics are described <a href="#metrics">above</a>.</p>
<p>Each metric template described in the configuration file will, after regex substitution, be transformed into a Snap metric. The metric name is converted into a metric namespace which you can filter in the Snap task file.</p>
<p>You can use wildcards to specify groups of metrics easily: </p><div class="fragment"><div class="line">/cfm/anycollect/*: {}</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Nov 29 2018 10:40:20 for AnyCollect by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
